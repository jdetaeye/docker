# -*- coding: utf-8 -*-
#
# Copyright (C) 2007-2015 by frePPLe bv
#
# This library is free software; you can redistribute it and/or modify it
# under the terms of the GNU Affero General Public License as published
# by the Free Software Foundation; either version 3 of the License, or
# (at your option) any later version.
#
# This library is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero
# General Public License for more details.
#
# You should have received a copy of the GNU Affero General Public
# License along with this program.  If not, see <http://www.gnu.org/licenses/>.
#

r"""
Main Django configuration file.
"""
import os
import sys

from django.utils.translation import gettext_lazy as _

try:
    DEBUG = "runserver" in sys.argv
except Exception:
    DEBUG = False
DEBUG_JS = DEBUG

ADMINS = (
    ('{{ default .Env.FREPPLE_ADMIN_NAME "false" }}', '{{ default .Env.FREPPLE_ADMIN_EMAIL "admin@example.com" }}'),
)

# ================= START UPDATED BLOCK BY WINDOWS INSTALLER =================

SECRET_KEY = "{{ default .Env.FREPPLE_SECRET_KEY "false" }}"

DATABASES = {
    "default": {
        "ENGINE": "django.db.backends.postgresql",
        "NAME": "{{ default .Env.PGDATABASE "false" }}",
        "USER": "{{ default .Env.PGUSER "frepple" }}",
        "PASSWORD": "{{ default .Env.PGPASSWORD "frepple" }}",
        "HOST": "{{ default .Env.PGHOST "localhost" }}",
        "PORT": "{{ default .Env.PGPORT "5432" }}",
        "OPTIONS": {{ default .Env.FREPPLE_OPTIONS "{}" }},
        "CONN_MAX_AGE": {{ default .Env.FREPPLE_CONN_MAX_AGE "60" }},
        "TEST": {
            "NAME": "{{ default .Env.FREPPLE_TEST_NAME "test_frepple" }}"  # Database name used when running the test suite.
        },
        "FILEUPLOADFOLDER": os.path.normpath(
            os.path.join(FREPPLE_LOGDIR, "data", "default")
        ),
        "SQL_ROLE": "{{ default .Env.FREPPLE_SQL_ROLE "report_role" }}",
        "SECRET_WEBTOKEN_KEY": "{{ default .Env.FREPPLE_SECRET_WEBTOKEN_KEY "SECRET_KEY" }}",
        "FREPPLE_PORT": "{{ default .Env.FREPPLE_PORT_DEFAULT "127.0.0.1:8002" }}"
    },
    "scenario1": {
        "ENGINE": "django.db.backends.postgresql",
        "NAME": "scenario1",
        "USER": "{{ default .Env.PGUSER "frepple" }}",
        "PASSWORD": "{{ default .Env.PGPASSWORD "frepple" }}",
        "HOST": "{{ default .Env.PGHOST "localhost" }}",
        "PORT": "{{ default .Env.PGPORT "5432" }}",
        "OPTIONS": {{ default .Env.FREPPLE_OPTIONS "{}" }},
        "CONN_MAX_AGE": {{ default .Env.FREPPLE_CONN_MAX_AGE "60" }},
        "TEST": {
            "NAME": "test_scenario1"  # Database name used when running the test suite.
        },
        "FILEUPLOADFOLDER": os.path.normpath(
            os.path.join(FREPPLE_LOGDIR, "data", "scenario1")
        ),
        "SQL_ROLE": "{{ default .Env.FREPPLE_SQL_ROLE "report_role" }}",
        "SECRET_WEBTOKEN_KEY": "{{ default .Env.FREPPLE_SECRET_WEBTOKEN_KEY "SECRET_KEY" }}",
        "FREPPLE_PORT": "{{ default .Env.FREPPLE_PORT_SCENARIO1 "127.0.0.1:8003" }}"
    },
    "scenario2": {
        "ENGINE": "django.db.backends.postgresql",
        "NAME": "scenario2",
        "USER": "{{ default .Env.PGUSER "frepple" }}",
        "PASSWORD": "{{ default .Env.PGPASSWORD "frepple" }}",
        "HOST": "{{ default .Env.PGHOST "localhost" }}",
        "PORT": "{{ default .Env.PGPORT "5432" }}",
        "OPTIONS": {{ default .Env.FREPPLE_OPTIONS "{}" }},
        "CONN_MAX_AGE": {{ default .Env.FREPPLE_CONN_MAX_AGE "60" }},
        "TEST": {
            "NAME": "test_scenario2"  # Database name used when running the test suite.
        },
        "FILEUPLOADFOLDER": os.path.normpath(
            os.path.join(FREPPLE_LOGDIR, "data", "scenario2")
        ),
        "SQL_ROLE": "{{ default .Env.FREPPLE_SQL_ROLE "report_role" }}",
        "SECRET_WEBTOKEN_KEY": "{{ default .Env.FREPPLE_SECRET_WEBTOKEN_KEY "SECRET_KEY" }}",
        "FREPPLE_PORT": "{{ default .Env.FREPPLE_PORT_SCENARIO2 "127.0.0.1:8004" }}"
    },
    "scenario3": {
        "ENGINE": "django.db.backends.postgresql",
        "NAME": "scenario3",
        "USER": "{{ default .Env.PGUSER "frepple" }}",
        "PASSWORD": "{{ default .Env.PGPASSWORD "frepple" }}",
        "HOST": "{{ default .Env.PGHOST "localhost" }}",
        "PORT": "{{ default .Env.PGPORT "5432" }}",
        "OPTIONS": {{ default .Env.FREPPLE_OPTIONS "{}" }},
        "CONN_MAX_AGE": {{ default .Env.FREPPLE_CONN_MAX_AGE "60" }},
        "TEST": {
            "NAME": "test_scenario3"  # Database name used when running the test suite.
        },
        "FILEUPLOADFOLDER": os.path.normpath(
            os.path.join(FREPPLE_LOGDIR, "data", "scenario3")
        ),
        "SQL_ROLE": "{{ default .Env.FREPPLE_SQL_ROLE "report_role" }}",
        "SECRET_WEBTOKEN_KEY": "{{ default .Env.FREPPLE_SECRET_WEBTOKEN_KEY "SECRET_KEY" }}",
        "FREPPLE_PORT": "{{ default .Env.FREPPLE_PORT_SCENARIO3 "127.0.0.1:8005" }}"
    },
}

LANGUAGE_CODE = "{{ default .Env.FREPPLE_LANGUAGE_CODE "en" }}"
GOOGLE_ANALYTICS = {{ default .Env.FREPPLE_GOOGLE_ANALYTICS "None" }}  # "UA-1950616-4"

# ================= END UPDATED BLOCK BY WINDOWS INSTALLER =================

SUPPORT_USERS = []
ODOO_PASSWORDS = {
  "default": "{{ default .Env.FREPPLE_ODOO_PASSWORD_DEFAULT "" }}",
  "scenario1": "{{ default .Env.FREPPLE_ODOO_PASSWORD_SCENARIO1 "" }}",
  "scenario2": "{{ default .Env.FREPPLE_ODOO_PASSWORD_SCENARIO2 "" }}",
  "scenario3": "{{ default .Env.FREPPLE_ODOO_PASSWORD_SCENARIO3 "" }}"
}
TIME_ZONE = "{{ default .Env.FREPPLE_TIME_ZONE "America/Phoenix" }}"
LANGUAGES = (
    ("en", _("English")),
    ("fr", _("French")),
    ("de", _("German")),
    ("he", _("Hebrew")),
    ("hr", _("Croatian")),
    ("it", _("Italian")),
    ("ja", _("Japanese")),
    ("nl", _("Dutch")),
    ("pt", _("Portuguese")),
    ("pt-br", _("Brazilian Portuguese")),
    ("ru", _("Russian")),
    ("es", _("Spanish")),
    ("zh-hans", _("Simplified Chinese")),
    ("zh-hant", _("Traditional Chinese")),
    ("uk", _("Ukrainian")),
)
SESSION_COOKIE_AGE = {{ default .Env.FREPPLE_SESSION_COOKIE_AGE "3600 * 24 * 3" }}  # 3 days
SESSION_LOGOUT_IDLE_TIME = {{ default .Env.FREPPLE_SESSION_LOGOUT_IDLE_TIME "60" }}
MIDDLEWARE = (
    "django.contrib.sessions.middleware.SessionMiddleware",
    "django.contrib.messages.middleware.MessageMiddleware",
    "freppledb.common.middleware.MultiDBMiddleware",
    "freppledb.common.middleware.HTTPAuthenticationMiddleware",
    "freppledb.common.middleware.LocaleMiddleware",
    "django.middleware.common.CommonMiddleware",
    "django.middleware.csrf.CsrfViewMiddleware",
)

INSTALLED_APPS = (
  'django.contrib.auth',
  'django.contrib.contenttypes',
  'django.contrib.messages',
  'django.contrib.staticfiles',
  'freppledb.boot',
  {{ default .Env.FREPPLE_INSTALLED_APPS_CUSTOM "" }}
  {{ if .Env.FREPPLE_INSTALLED_APPS_ODOO }}
  'freppledb.odoo',
  'freppledb.erpconnection',
  {{ end }}
  {{ if .Env.FREPPLE_INSTALLED_APPS_FORECASTING }}
  'freppledb.demandhits',
  'freppledb.forecast',
  'freppledb.webservice',
  {{ end }}
  {{ if .Env.FREPPLE_INSTALLED_APPS_INVENTORY }}
  'freppledb.inventoryplanning',
  {{ end }}
  'freppledb.wizard',
  'freppledb.input',
  'freppledb.output',
  'freppledb.metrics',
  'freppledb.execute',
  'freppledb.common',
  'django_filters',
  'rest_framework',
  'django.contrib.admin',
  'freppledb.reportmanager',
  'freppledb.executesql',
)

ATTRIBUTES = {{ default .Env.FREPPLE_ATTRIBUTES "[]" }}

CACHE_GRID_COUNT = {{ default .Env.FREPPLE_CACHE_GRID_COUNT "None" }}
CACHE_PIVOT_COUNT = {{ default .Env.FREPPLE_CACHE_PIVOT_COUNT "None" }}
CACHES = {
    "default": {
        "BACKEND": "django.core.cache.backends.locmem.LocMemCache",
    }
}

LOGGING = {
    "version": 1,
    "disable_existing_loggers": True,
    "filters": {"require_debug_false": {"()": "django.utils.log.RequireDebugFalse"}},
    "formatters": {
        "verbose": {
            "format": "%(levelname)s %(asctime)s %(module)s %(process)d %(thread)d %(message)s"
        },
        "simple": {"format": "%(levelname)s %(message)s"},
    },
    "handlers": {
        "null": {"level": "DEBUG", "class": "logging.NullHandler"},
        "console": {
            "level": "DEBUG",
            "class": "logging.StreamHandler",
            "formatter": "simple",
        },
        "mail_admins": {
            "level": "CRITICAL",
            "filters": ["require_debug_false"],
            "class": "django.utils.log.AdminEmailHandler",
        },
    },
    "loggers": {
        "django": {"handlers": ["console"], "level": "INFO"},
        "freppledb": {"handlers": ["console"], "level": "INFO"},
        "freppleapps": {"handlers": ["console"], "level": "INFO"},
    },
}

MAXMEMORYSIZE = {{ default .Env.FREPPLE_MAXMEMORYSIZE "None" }}  # limit in MB, minimum around 230, use None for unlimited
MAXCPUTIME = {{ default .Env.FREPPLE_MAXCPUTIME "None" }}  # limit in seconds, use None for unlimited
MAXTOTALLOGFILESIZE = {{ default .Env.FREPPLE_MAXTOTALLOGFILESIZE "200" }}
THEMES = [
    "earth",
    "grass",
    "lemon",
    "odoo",
    "openbravo",
    "orange",
    "snow",
    "strawberry",
    "water",
]

DEFAULT_USER_GROUP = {{ default .Env.FREPPLE_DEFAULT_USER_GROUP "None" }}
DEFAULT_THEME = "{{ default .Env.FREPPLE_DEFAULT_THEME "earth" }}"
DEFAULT_PAGESIZE = {{ default .Env.FREPPLE_DEFAULT_PAGESIZE "100" }}
DEFAULT_DASHBOARD = [
    {
        "rowname": _("Welcome"),
        "cols": [
            {"width": 8, "widgets": [("inbox", {"limit": 10})]},
            {"width": 4, "widgets": [("news", {})]},
        ],
    },
    {
        "rowname": _("sales"),
        "cols": [
            {
                "width": 9,
                "widgets": [
                    (
                        "analysis_demand_problems",
                        {"top": 20, "orderby": "latedemandvalue"},
                    )
                ],
            },
            {
                "width": 3,
                "widgets": [
                    ("demand_alerts", {}),
                    ("delivery_performance", {"green": 90, "yellow": 80}),
                    ("archived_demand", {"history": 12}),
                ],
            },
        ],
    },
    {
        "rowname": _("purchasing"),
        "cols": [
            {
                "width": 9,
                "widgets": [
                    ("purchase_orders", {"fence1": 7, "fence2": 30}),
                    # ("purchase_queue",{"limit":20}),
                    ("purchase_order_analysis", {"limit": 20}),
                ],
            },
            {
                "width": 3,
                "widgets": [
                    ("archived_purchase_order", {"history": 12}),
                    ("inventory_by_location", {"limit": 5}),
                    ("inventory_by_item", {"limit": 10}),
                ],
            },
        ],
    },
    {
        "rowname": _("distribution"),
        "cols": [
            {
                "width": 12,
                "widgets": [
                    ("distribution_orders", {"fence1": 7, "fence2": 30}),
                    # ("shipping_queue",{"limit":20}),
                    ("archived_buffer", {"history": 12}),
                ],
            }
        ],
    },
    {
        "rowname": _("manufacturing"),
        "cols": [
            {
                "width": 9,
                "widgets": [
                    ("manufacturing_orders", {"fence1": 7, "fence2": 30}),
                    # ("resource_queue",{"limit":20}),
                ],
            },
            {
                "width": 3,
                "widgets": [
                    ("capacity_alerts", {}),
                    ("resource_utilization", {"limit": 5, "medium": 80, "high": 90}),
                ],
            },
        ],
    },
]

AUTH_PASSWORD_VALIDATORS = [
    {
        "NAME": "django.contrib.auth.password_validation.UserAttributeSimilarityValidator"
    },
    {
        "NAME": "django.contrib.auth.password_validation.MinimumLengthValidator",
        "OPTIONS": {"min_length": 8},
    },
    {"NAME": "django.contrib.auth.password_validation.CommonPasswordValidator"},
    {"NAME": "django.contrib.auth.password_validation.NumericPasswordValidator"},
]

EMAIL_USE_TLS = {{ default .Env.FREPPLE_EMAIL_USE_TLS "True" }}
DEFAULT_FROM_EMAIL = "{{ default .Env.FREPPLE_DEFAULT_FROM_EMAIL "your_email@domain.com" }}"
SERVER_EMAIL = "{{ default .Env.FREPPLE_SERVER_EMAIL "your_email@domain.com" }}"
EMAIL_HOST_USER = "{{ default .Env.FREPPLE_EMAIL_HOST_USER "your_email@domain.com" }}"
EMAIL_HOST_PASSWORD = "{{ default .Env.FREPPLE_EMAIL_HOST_PASSWORD "frePPLeIsTheBest" }}"
EMAIL_HOST = {{ default .Env.FREPPLE_EMAIL_HOST "None" }}
EMAIL_PORT = {{ default .Env.FREPPLE_EMAIL_PORT "25" }}
EMAIL_BACKEND = "django.core.mail.backends.smtp.EmailBackend"

CONTENT_SECURITY_POLICY = "frame-ancestors 'self'"
X_FRAME_OPTIONS = "SAMEORIGIN"

FTP_PROTOCOL = "{{ default .Env.FREPPLE_FTP_PROTOCOL "SFTP" }}"
FTP_HOST = {{ default .Env.FREPPLE_FTP_HOST "None" }}
FTP_PORT = {{ default .Env.FREPPLE_FTP_PORT "22" }}
FTP_USER = {{ default .Env.FREPPLE_FTP_USER "None" }}
FTP_PASSWORD = {{ default .Env.FREPPLE_FTP_PASSWORD "None" }}
FTP_FOLDER = {
    "default": {{ default .Env.FREPPLE_FTP_FOLDER_DEFAULT "None" }},
    "scenario1": {{ default .Env.FREPPLE_FTP_FOLDER_SCENARIO1 "None" }},
    "scenario2": {{ default .Env.FREPPLE_FTP_FOLDER_SCENARIO2 "None" }},
    "scenario3": {{ default .Env.FREPPLE_FTP_FOLDER_SCENARIO3 "None" }},
}

PORT = {{ default .Env.FREPPLE_PORT "8000" }}

SELENIUM_TESTS = "{{ default .Env.FREPPLE_SELENIUM_TESTS "chrome" }}"
SELENIUM_HEADLESS = {{ default .Env.FREPPLE_SELENIUM_HEADLESS "True" }}

CSRF_COOKIE_SAMESITE = {{ default .Env.FREPPLE_CSRF_COOKIE_SAMESITE "None" }}
CSRF_COOKIE_SECURE = {{ default .Env.FREPPLE_CSRF_COOKIE_SECURE "True" }}
SESSION_COOKIE_SAMESITE = {{ default .Env.FREPPLE_SESSION_COOKIE_SAMESITE "None" }}
SESSION_COOKIE_SECURE = {{ default .Env.FREPPLE_SESSION_COOKIE_SECURE "True" }}
